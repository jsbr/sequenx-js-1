var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Sequenx;!function(t){var e=function(){function e(e,i){void 0===i&&(i=!1),this.autoStart=i,this._pendingExecution=t.Disposable.empty,this._tasks=new Array,this._isStarted=!1,this._isDisposed=!1,this._isCompleted=!1,this._isExecuting=!1,e?"string"==typeof e?this._log=new t.Log(e):e&&(this._log=e):this._log=new t.Log(""),i&&setTimeout(this.start.bind(this),0)}return Object.defineProperty(e.prototype,"name",{get:function(){return this._log.name},enumerable:!0,configurable:!0}),e.prototype.createChildLog=function(t){return this._log.createChild(t)},e.prototype.add=function(t){if(!t.start)return void this._log.error("Trying to add something other than Sequenx.Item, use do if you use a function(lapse)");if(this._isDisposed)throw new Error("Trying to add action to a disposed sequence.");this._tasks.push(t)},e.prototype.start=function(t){this._isStarted||this._isDisposed||this.autoStart||(this._isCompleted&&t&&t(),this._isStarted=!0,this._cbComplete=t||this._cbComplete,this.scheduleNext())},e.prototype.onCompleted=function(t){return this._cbComplete=t,this},e.prototype.dispose=function(){this._isDisposed||(!this._isCompleted&&this._log&&this._log.warning("Cancelling ("+this._tasks.length+" items)"),this.onSequenceComplete())},e.prototype.scheduleNext=function(){this._pendingExecution.dispose(),this.executeNext()},e.prototype.onLastItemCompleted=function(){this.onSequenceComplete()},e.prototype.executeNext=function(){var t=this;if(!(this._isExecuting||this._isCompleted||this._isDisposed)){if(0===this._tasks.length)return void this.onLastItemCompleted();var e=this._tasks.shift();try{this._isExecuting=!0,e.start(function(){t._isExecuting=!1,t.scheduleNext()})}catch(t){throw this._isExecuting=!1,t}}},e.prototype.onSequenceComplete=function(){this._isCompleted||(this._tasks.length=0,this._isCompleted=!0,this._isDisposed=!0,this._log.dispose(),this._cbComplete&&this._cbComplete())},e.prototype.do=function(e,i){return this.add(new t.CallbackTask(e,i)),this},e.prototype.doDispose=function(t,e){return this.do(function(){return t.dispose()},e?e:"Dispose"),this},e.prototype.doWait=function(t,e){return this.do(function(e){return setTimeout(e,t)},e?e:"Wait "+t/1e3+"s"),this},e.prototype.doWaitForDispose=function(e){var i=new t.Disposable;return this.do(function(t){i.action=t},e?e:"WaitForDispose"),i},e.prototype.doMark=function(e){return this.add(new t.MarkTask(e)),this},e.prototype.doParallel=function(e,i){var o=new t.Parallel;return o.message=i?i:"Parallel",e(o),this.add(o),this},e.prototype.doSequence=function(t,i){i=i?i:"Sequence";var o=new e(i);return t(o),this.add(o),this},e.prototype.skipToMarker=function(e,i){void 0===i&&(i=!1),this.skipTo(function(i){return i instanceof t.MarkTask&&i.marker===e})},e.prototype.skipToEnd=function(){this.skip(function(t){return!0})},e.prototype.skip=function(t){for(;this._tasks.length>0&&t(this._tasks[0]);)this._tasks.splice(0,1)},e.prototype.skipTo=function(t){for(var e=-1,i=0;i<this._tasks.length;i++)if(t(this._tasks[i])){e=i;break}e!==-1&&(this._tasks=this._tasks.slice(e))},e}();t.Sequence=e}(Sequenx||(Sequenx={})),"undefined"!=typeof module&&module.exports&&(this.Rx=require("rx-lite"));var Sequenx;!function(t){t.Sequence.prototype.doWaitForCompleted=function(t,e){return this.do(function(e){return t.subscribeOnCompleted(e)},e?e:"WaitForCompleted"),this},t.Sequence.prototype.doWaitForNext=function(t,e){return this.do(function(e){return t.subscribeOnNext(e)},e?e:"WaitForNext"),this}}(Sequenx||(Sequenx={}));var Sequenx;!function(t){var e=function(){function t(t){this.action=t,this._isDisposed=!1}return t.create=function(e){return new t(e)},Object.defineProperty(t.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){!this._isDisposed&&this.action&&this.action(),this._isDisposed=!0},t.empty=new t,t}();t.Disposable=e;var i=function(t){function i(e){t.call(this),this.disposable=e,this._count=0}return __extends(i,t),i.prototype.dispose=function(){this._isDisposed||(this._isPrimaryDisposed=!0,this._count<=0&&(this._isDisposed=!0,this.disposable.dispose()))},i.prototype.getDisposable=function(){var t=this;return this._isDisposed?e.empty:(this._count++,e.create(function(){t._count--,t._isPrimaryDisposed&&t._count<=0&&t.disposable.dispose()}))},i}(e);t.RefCountDisposable=i}(Sequenx||(Sequenx={}));var Sequenx;!function(t){var e=function(){function t(e,i){this._parent=i,this._name=null!=e?e:"",this._id=t.s_nextId++,t.isEnabled&&console.log(this.fullName+t.StartSuffix)}return Object.defineProperty(t.prototype,"name",{get:function(){return this._name},set:function(t){},enumerable:!0,configurable:!0}),t.prototype.toString=function(){return this.fullName},t.prototype.dispose=function(){this._isDisposed||(t.isEnabled&&console.log(this.fullName+t.EndSuffix),this._isDisposed=!0)},t.prototype.createChild=function(e){return new t(e,this)},t.prototype.info=function(e){for(var i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];t.isEnabled&&console.log(this.format(e,i))},t.prototype.warning=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];console.warn(this.format(t,e))},t.prototype.error=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];console.error(this.format(t,e))},Object.defineProperty(t.prototype,"fullName",{get:function(){return null==this._fullName&&(null!=this._parent?this._fullName=this._parent.fullName+t.PathSeparator+this.getNameWithId():this._fullName=this.getNameWithId()),this._fullName},enumerable:!0,configurable:!0}),t.prototype.getNameWithId=function(){return"("+this._id+") "+this._name},t.prototype.format=function(e,i){return e&&null!=i&&i.length>0&&(e=this.strFormat(e,i)),this.fullName+t.MessageSeparator+e},t.prototype.strFormat=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var o=e;return t.replace(/{(\d+)}/g,function(t,e){return"undefined"!=typeof o[e]?o[e]:t})},t.PathSeparator="     ",t.MessageSeparator="     ",t.StartSuffix=" [START]",t.EndSuffix=" [END]",t.s_nextId=1,t.isEnabled=!0,t}();t.Log=e}(Sequenx||(Sequenx={}));var Sequenx;!function(t){t.Sequence.prototype.doPromise=function(t){return this.do(function(e){return t().then(function(t){return e()})}),this},t.Sequence.prototype.startPromise=function(){var t=this;return new Promise(function(e){return t.start(e)})}}(Sequenx||(Sequenx={})),Promise.prototype.start=function(t){this.then(t)};var Sequenx;!function(t){var e=function(){function t(t,e){this.action=t,this.message=e}return t.prototype.start=function(t){this.action.length>0?this.action(t):(this.action(),t())},t.prototype.toString=function(){return this.message,(null!=this.action).toString()},t}();t.CallbackTask=e}(Sequenx||(Sequenx={}));var Sequenx;!function(t){var e=function(){function t(t,e){this.marker=t,this.message=e}return t.prototype.start=function(t){t()},t.prototype.toString=function(){return this.message,this.marker},t}();t.MarkTask=e}(Sequenx||(Sequenx={}));var Sequenx;!function(t){var e=function(t){function e(e,i){void 0===i&&(i=!1),t.call(this,e,i)}return __extends(e,t),e.prototype.scheduleNext=function(){var t=this,e=this._tasks.length;return e?(this._tasks.forEach(function(i){return i.start(function(){return--e<=0&&t._cbComplete&&t._cbComplete()})}),void(this._tasks=[])):this._cbComplete&&this._cbComplete()},e.prototype.skip=function(t){throw new Error("skip not implemented for Parallel")},e.prototype.skipTo=function(t){throw new Error("skipTo not implemented for Parallel")},e}(t.Sequence);t.Parallel=e}(Sequenx||(Sequenx={}));var Sequenx;!function(t){t.Sequence.prototype.doLapse=function(e,i){void 0===i&&(i="Lapse");var o=new t.Lapse(this.createChildLog(i));return this.do(function(t){e(o),o.start(t)}),this}}(Sequenx||(Sequenx={}));var Sequenx;!function(t){var e=function(){function e(e,i){var o=this;void 0===i&&(i=!1),this.autoStart=i,e?"string"==typeof e?this._log=new t.Log(e):this._log=e:this._log=new t.Log(""),this._refCountDisposable=new t.RefCountDisposable(t.Disposable.create(function(){return o.lapseCompleted()})),i&&setTimeout(function(){return o.start()},0)}return Object.defineProperty(e.prototype,"name",{get:function(){return this._log.name},enumerable:!0,configurable:!0}),e.prototype.createChildLog=function(t){return this._log.createChild(t)},e.prototype.sustain=function(e){return this._isCompleted||this._isDisposed?t.Disposable.empty:(e&&t.Log.isEnabled&&this._log.info("Sustain "+e),this._refCountDisposable.getDisposable())},e.prototype.onCompleted=function(t){this._completed=t},e.prototype.start=function(t){this._isStarted||this._isCompleted||this._isDisposed||(this._isStarted=!0,this._completed=t||this._completed,this._refCountDisposable.dispose())},e.prototype.dispose=function(){this._isDisposed||(this._isCompleted||this._log.info("Cancelling"),this.lapseCompleted())},e.prototype.lapseCompleted=function(){this._isCompleted||(this._isCompleted=!0,this._isDisposed=!0,this._log.dispose(),this._completed&&this._completed())},e.prototype.sequence=function(e,i){var o=this.sustain(),n=i?i:"Sequence",s=this.createChildLog(n),r=new t.Sequence(s);return e(r),r.start(function(){return o.dispose()}),r},e.prototype.child=function(t,i){var o=this.sustain(),n=i?i:"Child",s=this.createChildLog(n),r=new e(s);t(r),r.start(function(){return o.dispose()})},e}();t.Lapse=e}(Sequenx||(Sequenx={})),"undefined"!=typeof module&&module.exports&&(module.exports=Sequenx);